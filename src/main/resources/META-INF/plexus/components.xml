<?xml version="1.0" encoding="UTF-8"?>
<!--
  Copyright (C) 2016 Ronald Jack Jenkins Jr.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<!-- Derived from components-fragment.xml in maven-release-manager, see THIRDPARTY file for further legal information. -->
<component-set>
  <components>
    <!-- Smart Reactor. -->
    <component>
      <role>org.apache.maven.AbstractMavenLifecycleParticipant
      </role>
      <role-hint>rtr</role-hint>
      <implementation>info.ronjenkins.maven.rtr.RTR
      </implementation>
      <configuration>
        <startSteps>
          <startStep>validate-eligibility</startStep>
          <startStep>build-smart-reactor</startStep>
          <startStep>sanity-checks</startStep>
          <startStep>transform-poms</startStep>
          <startStep>rebuild-release-reactor</startStep>
          <startStep>rebuild-graph</startStep>
        </startSteps>
        <endSuccessSteps>
          <endSuccessStep>post-release-success</endSuccessStep>
        </endSuccessSteps>
        <endFailureSteps>
          <endFailureStep>post-release-failure</endFailureStep>
        </endFailureSteps>
      </configuration>
    </component>
    <!-- Smart Reactor release steps. -->
    <component>
      <role>info.ronjenkins.maven.rtr.steps.SmartReactorStep
      </role>
      <role-hint>transform-poms</role-hint>
      <implementation>info.ronjenkins.maven.rtr.steps.release.TransformProjectsIntoReleases
      </implementation>
      <configuration>
        <releasePhases>
          <releasePhase>check-poms</releasePhase>
          <releasePhase>conditional-check-dependency-snapshots
          </releasePhase><!-- custom -->
          <releasePhase>create-backup-poms</releasePhase>
          <releasePhase>indicate-presence-of-backup-poms</releasePhase><!-- custom -->
          <releasePhase>map-release-versions</releasePhase>
          <releasePhase>input-variables</releasePhase>
          <releasePhase>rewrite-poms-for-release</releasePhase>
          <releasePhase>end-release</releasePhase>
        </releasePhases>
        <rollbackPhases>
          <rollbackPhase>defensive-restore-backup-poms</rollbackPhase><!-- custom -->
          <rollbackPhase>remove-backup-poms</rollbackPhase><!-- custom -->
        </rollbackPhases>
      </configuration>
    </component>
    <component>
      <role>info.ronjenkins.maven.rtr.steps.SmartReactorStep
      </role>
      <role-hint>post-release-success</role-hint>
      <implementation>info.ronjenkins.maven.rtr.steps.release.DoPostReleaseSuccess
      </implementation>
      <configuration>
        <releasePhases>
          <releasePhase>remove-backup-poms</releasePhase><!-- custom -->
        </releasePhases>
      </configuration>
    </component>
    <component>
      <role>info.ronjenkins.maven.rtr.steps.SmartReactorStep
      </role>
      <role-hint>post-release-failure</role-hint>
      <implementation>info.ronjenkins.maven.rtr.steps.release.DoPostReleaseFailure
      </implementation>
      <configuration>
        <releasePhases>
          <releasePhase>defensive-restore-backup-poms</releasePhase><!-- custom -->
          <releasePhase>remove-backup-poms</releasePhase><!-- custom -->
        </releasePhases>
      </configuration>
    </component>
    <!-- Phases used by the maven-release-manager. -->
    <component>
      <role>org.apache.maven.shared.release.phase.ReleasePhase
      </role>
      <role-hint>check-poms</role-hint>
      <implementation>org.apache.maven.shared.release.phase.CheckPomPhase
      </implementation>
      <configuration>
        <scmRequired>true</scmRequired>
        <snapshotsRequired>true</snapshotsRequired>
      </configuration>
      <requirements>
        <requirement>
          <role>org.apache.maven.shared.release.scm.ScmRepositoryConfigurator
          </role>
        </requirement>
      </requirements>
    </component>
    <component>
      <role>org.apache.maven.shared.release.phase.ReleasePhase
      </role>
      <role-hint>conditional-check-dependency-snapshots</role-hint>
      <implementation>info.ronjenkins.maven.rtr.releasephases.ConditionalCheckDependencySnapshotsPhase
      </implementation>
      <requirements>
        <requirement>
          <role>org.apache.maven.artifact.factory.ArtifactFactory
          </role>
          <role-hint>rtr-af</role-hint>
        </requirement>
      </requirements>
    </component>
    <component>
      <role>org.apache.maven.shared.release.phase.ReleasePhase
      </role>
      <role-hint>map-release-versions</role-hint>
      <implementation>org.apache.maven.shared.release.phase.MapVersionsPhase
      </implementation>
      <configuration>
        <convertToSnapshot>false</convertToSnapshot>
      </configuration>
      <requirements>
        <requirement>
          <role>org.codehaus.plexus.components.interactivity.Prompter
          </role>
          <role-hint>default</role-hint>
        </requirement>
        <requirement>
          <role>org.apache.maven.shared.release.policy.version.VersionPolicy
          </role>
          <field-name>versionPolicies</field-name>
        </requirement>
      </requirements>
    </component>
    <component>
      <role>org.apache.maven.shared.release.phase.ReleasePhase
      </role>
      <role-hint>rewrite-poms-for-release</role-hint>
      <implementation>org.apache.maven.shared.release.phase.RewritePomsForReleasePhase
      </implementation>
      <configuration>
        <pomSuffix>tag</pomSuffix>
      </configuration>
      <requirements>
        <requirement>
          <role>org.apache.maven.shared.release.scm.ScmRepositoryConfigurator
          </role>
        </requirement>
        <requirement>
          <role>org.apache.maven.shared.release.scm.ScmTranslator
          </role>
          <field-name>scmTranslators</field-name>
        </requirement>
      </requirements>
    </component>
    <component>
      <role>org.apache.maven.shared.release.phase.ReleasePhase
      </role>
      <role-hint>defensive-restore-backup-poms</role-hint>
      <implementation>info.ronjenkins.maven.rtr.releasephases.DefensiveRestoreBackupPomsPhase
      </implementation>
      <requirements>
        <requirement>
          <role>org.apache.maven.shared.release.scm.ScmRepositoryConfigurator
          </role>
        </requirement>
      </requirements>
    </component>
    <!-- Transient dependencies required by the maven-release-manager classes. -->
    <component>
      <role>org.apache.maven.artifact.factory.ArtifactFactory
      </role>
      <role-hint>rtr-af</role-hint>
      <implementation>org.apache.maven.artifact.factory.DefaultArtifactFactory
      </implementation>
    </component>
    <component>
      <role>org.apache.maven.artifact.handler.manager.ArtifactHandlerManager
      </role>
      <role-hint>rtr-ahm</role-hint>
      <implementation>org.apache.maven.artifact.handler.manager.DefaultArtifactHandlerManager
      </implementation>
    </component>
    <component>
      <role>org.apache.maven.project.path.PathTranslator
      </role>
      <role-hint>rtr-pt</role-hint>
      <implementation>org.apache.maven.project.path.DefaultPathTranslator
      </implementation>
    </component>
    <component>
      <role>org.apache.maven.shared.release.config.ReleaseDescriptor
      </role>
      <role-hint>rtr-rd</role-hint>
      <implementation>org.apache.maven.shared.release.config.ReleaseDescriptor
      </implementation>
      <configuration>
        <interactive>${session.settings.interactive}</interactive>
        <workingDirectory>${session.request.baseDirectory}
        </workingDirectory>
      </configuration>
    </component>
    <component>
      <role>org.apache.maven.shared.release.env.ReleaseEnvironment
      </role>
      <role-hint>rtr-re</role-hint>
      <implementation>org.apache.maven.shared.release.env.DefaultReleaseEnvironment
      </implementation>
      <configuration>
        <!-- settings are injected from the session object at runtime -->
        <javaHome>${session.systemProperties.getProperty("user.home")}
        </javaHome>
        <mavenHome>${session.systemProperties.getProperty("maven.home")}
        </mavenHome>
        <localRepositoryDirectory>${session.request.localRepositoryPath}
        </localRepositoryDirectory>
      </configuration>
    </component>
  </components>
</component-set>
